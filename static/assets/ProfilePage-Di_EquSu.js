import{u as E,b as s,o as M,a as u,i as n,c as t,C as p,B as f,S as N,f as l,t as c}from"./index-6s_4JTtF.js";import{I as i}from"./Input-DbQWqGqX.js";import{usersApi as P}from"./users-Bw0aJsUF.js";var A=c('<h2 class="text-lg font-semibold text-content mb-4">修改密码'),L=c("<div class=space-y-3>"),W=c('<div class="max-w-lg mx-auto space-y-6 animate-fade-in-up"><h1 class="text-2xl font-bold text-content">个人中心'),j=c('<div class=space-y-4><div><p class="text-sm text-content-secondary">邮箱</p><p class="text-content font-medium">');function G(){const _=E(),[d,m]=s(""),[$,v]=s(!1),[g,h]=s(""),[o,w]=s(""),[y,x]=s(""),[b,C]=s(!1);M(()=>{const e=u.user();e&&m(e.username)});async function S(){if(d().trim()){v(!0);try{const e=await P.updateMe({username:d()});u.updateUser(e),l.toast.success("用户名已更新")}catch(e){l.toast.error("更新失败",e instanceof Error?e.message:"")}finally{v(!1)}}}async function I(){if(!(!g()||!o())){if(o().length<6){l.toast.error("新密码至少 6 位");return}if(o()!==y()){l.toast.error("两次密码不一致");return}C(!0);try{await P.changePassword({current_password:g(),new_password:o()}),l.toast.success("密码已修改"),h(""),w(""),x("")}catch(e){l.toast.error("修改失败",e instanceof Error?e.message:"")}finally{C(!1)}}}async function T(){await u.logout(),_("/login",{replace:!0})}return(()=>{var e=W();return e.firstChild,n(e,t(N,{get when(){return u.user()},children:a=>t(p,{variant:"elevated",get children(){var r=j(),k=r.firstChild,U=k.firstChild,z=U.nextSibling;return n(z,()=>a().email),n(r,t(i,{label:"用户名",get value(){return d()},onInput:B=>m(B.currentTarget.value)}),null),n(r,t(f,{onClick:S,get loading(){return $()},size:"sm",children:"保存"}),null),r}})}),null),n(e,t(p,{variant:"elevated",get children(){return[A(),(()=>{var a=L();return n(a,t(i,{label:"当前密码",type:"password",get value(){return g()},onInput:r=>h(r.currentTarget.value)}),null),n(a,t(i,{label:"新密码",type:"password",placeholder:"至少 6 位",get value(){return o()},onInput:r=>w(r.currentTarget.value)}),null),n(a,t(i,{label:"确认新密码",type:"password",placeholder:"再次输入新密码",get value(){return y()},onInput:r=>x(r.currentTarget.value)}),null),n(a,t(f,{onClick:I,get loading(){return b()},size:"sm",variant:"secondary",children:"修改密码"}),null),a})()]}}),null),n(e,t(p,{variant:"outlined",get children(){return t(f,{onClick:T,variant:"danger",fullWidth:!0,children:"退出登录"})}}),null),e})()}export{G as default};
