import{c as e,i as r,F as O,s as W,e as F,l as A,n as D,S as E,t as b,p as N,b as g,o as Q,B as M,C as X,d as Y,f as y,r as Z}from"./index-6s_4JTtF.js";import{I}from"./Input-DbQWqGqX.js";import{B as H}from"./Badge-k5WGClrt.js";import{M as V}from"./Modal-BkEW8yGb.js";import{E as ee}from"./Empty-ceooNyMm.js";import{w as z}from"./words-Cj2cVitv.js";var te=b('<nav aria-label=分页><button aria-label=上一页 class="p-2 rounded-lg text-content-secondary hover:bg-surface-secondary disabled:opacity-40 disabled:pointer-events-none transition-colors cursor-pointer"><svg class="w-4 h-4"fill=none viewBox="0 0 24 24"stroke=currentColor stroke-width=2><path stroke-linecap=round stroke-linejoin=round d="M15 19l-7-7 7-7"></path></svg></button><button aria-label=下一页 class="p-2 rounded-lg text-content-secondary hover:bg-surface-secondary disabled:opacity-40 disabled:pointer-events-none transition-colors cursor-pointer"><svg class="w-4 h-4"fill=none viewBox="0 0 24 24"stroke=currentColor stroke-width=2><path stroke-linecap=round stroke-linejoin=round d="M9 5l7 7-7 7">'),ne=b('<span class="px-2 text-content-tertiary">...'),re=b("<button>");function ae(t){const m=()=>Math.max(1,Math.ceil(t.total/t.pageSize)),k=()=>t.page>1,C=()=>t.page<m(),S=()=>{const o=m(),f=t.page,c=[];if(o<=7)for(let n=1;n<=o;n++)c.push(n);else{c.push(1),f>3&&c.push("...");for(let n=Math.max(2,f-1);n<=Math.min(o-1,f+1);n++)c.push(n);f<o-2&&c.push("..."),c.push(o)}return c};return e(E,{get when(){return m()>1},get children(){var o=te(),f=o.firstChild,c=f.nextSibling;return f.$$click=()=>t.onChange(t.page-1),r(o,e(O,{get each(){return S()},children:n=>n==="..."?ne():(()=>{var u=re();return u.$$click=()=>t.onChange(n),W(u,"aria-label",`第 ${n} 页`),r(u,n),F(a=>{var i=t.page===n?"page":void 0,p=A("w-8 h-8 rounded-lg text-sm font-medium transition-colors cursor-pointer",t.page===n?"bg-accent text-accent-content":"text-content-secondary hover:bg-surface-secondary");return i!==a.e&&W(u,"aria-current",a.e=i),p!==a.t&&D(u,a.t=p),a},{e:void 0,t:void 0}),u})()}),c),c.$$click=()=>t.onChange(t.page+1),F(n=>{var u=A("flex items-center gap-1",t.class),a=!k(),i=!C();return u!==n.e&&D(o,n.e=u),a!==n.t&&(f.disabled=n.t=a),i!==n.a&&(c.disabled=n.a=i),n},{e:void 0,t:void 0,a:void 0}),o}})}N(["click"]);var le=b('<div class="grid gap-3">'),se=b('<div class="flex justify-between items-center"><p class="text-sm text-content-tertiary">共 <!> 个单词'),ie=b('<div class="space-y-6 animate-fade-in-up"><div class="flex items-center justify-between flex-wrap gap-3"><h1 class="text-2xl font-bold text-content">词库管理</h1><div class="flex gap-2"></div></div><form class="flex gap-2">'),oe=b('<div class="flex justify-center py-12">'),ce=b('<span class="text-xs text-content-tertiary">'),ue=b('<div class="flex-1 min-w-0"><div class="flex items-center gap-2"><span class="font-semibold text-content"></span></div><p class="text-sm text-content-secondary truncate">'),de=b('<div class="flex items-center gap-1 flex-shrink-0"><button class="p-1.5 rounded text-content-tertiary hover:text-accent transition-colors cursor-pointer"><svg class="w-4 h-4"fill=none viewBox="0 0 24 24"stroke=currentColor stroke-width=2><path stroke-linecap=round stroke-linejoin=round d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></button><button class="p-1.5 rounded text-content-tertiary hover:text-error transition-colors cursor-pointer"><svg class="w-4 h-4"fill=none viewBox="0 0 24 24"stroke=currentColor stroke-width=2><path stroke-linecap=round stroke-linejoin=round d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">'),ge=b('<div class="space-y-3 mt-2"><div class="flex justify-end gap-2 pt-2">'),he=b(`<div class="flex flex-col gap-1.5"><label class="text-sm font-medium text-content-secondary">粘贴内容</label><textarea class="w-full px-3 py-2 rounded-lg text-sm bg-surface text-content border border-border focus:outline-none focus:ring-2 focus:ring-accent/30 focus:border-accent resize-y min-h-[160px] font-mono"placeholder="abandon	放弃
resilient - 有弹性的"></textarea><p class="text-xs text-content-tertiary">支持 Tab 分隔或 " - " 分隔，# 开头为注释`),fe=b('<div class="space-y-4 mt-2"><div class="flex gap-2"></div><div class="flex justify-end gap-2">');function we(){const[t,m]=g([]),[k,C]=g(0),[S,o]=g(1),[f,c]=g(""),[n,u]=g(!0),[a,i]=g(!1),[p,s]=g(!1),[x,l]=g(null),d=20;async function v(){u(!0);try{const h=await z.list({limit:d,offset:(S()-1)*d,search:f()||void 0});m(h.items),C(h.total)}catch(h){y.toast.error("加载失败",h instanceof Error?h.message:"")}finally{u(!1)}}Q(v);function q(h){h.preventDefault(),o(1),v()}function G(h){o(h),v()}async function J(h){if(confirm("确定删除该单词？"))try{await z.delete(h),y.toast.success("已删除"),v()}catch(j){y.toast.error("删除失败",j instanceof Error?j.message:"")}}return(()=>{var h=ie(),j=h.firstChild,K=j.firstChild,U=K.nextSibling,B=j.nextSibling;return r(U,e(M,{onClick:()=>s(!0),variant:"outline",size:"sm",children:"批量导入"}),null),r(U,e(M,{onClick:()=>{l(null),i(!0)},size:"sm",children:"添加单词"}),null),B.addEventListener("submit",q),r(B,e(I,{placeholder:"搜索单词...",get value(){return f()},onInput:w=>c(w.currentTarget.value),class:"flex-1"}),null),r(B,e(M,{type:"submit",variant:"secondary",children:"搜索"}),null),r(h,e(E,{get when(){return!n()},get fallback(){return(()=>{var w=oe();return r(w,e(Y,{size:"lg"})),w})()},get children(){return e(E,{get when(){return t().length>0},get fallback(){return e(ee,{title:"暂无单词",description:"点击添加单词或批量导入"})},get children(){return[(()=>{var w=le();return r(w,e(O,{get each(){return t()},children:$=>e(X,{variant:"outlined",padding:"sm",class:"flex items-center justify-between gap-4",get children(){return[(()=>{var T=ue(),_=T.firstChild,L=_.firstChild,P=_.nextSibling;return r(L,()=>$.text),r(_,e(E,{get when(){return $.pronunciation},get children(){var R=ce();return r(R,()=>$.pronunciation),R}}),null),r(_,e(E,{get when(){return $.partOfSpeech},get children(){return e(H,{size:"sm",variant:"accent",get children(){return $.partOfSpeech}})}}),null),r(P,()=>$.meaning),T})(),(()=>{var T=de(),_=T.firstChild,L=_.nextSibling;return r(T,e(O,{get each(){return $.tags.slice(0,2)},children:P=>e(H,{size:"sm",children:P})}),_),_.$$click=()=>{l($),i(!0)},L.$$click=()=>J($.id),T})()]}})})),w})(),(()=>{var w=se(),$=w.firstChild,T=$.firstChild,_=T.nextSibling;return _.nextSibling,r($,k,_),r(w,e(ae,{get page(){return S()},get total(){return k()},pageSize:d,onChange:G}),null),w})()]}})}}),null),r(h,e(ve,{get open(){return a()},onClose:()=>i(!1),get word(){return x()},onSaved:v}),null),r(h,e(me,{get open(){return p()},onClose:()=>s(!1),onDone:v}),null),h})()}function ve(t){const[m,k]=g(""),[C,S]=g(""),[o,f]=g(""),[c,n]=g(""),[u,a]=g(""),[i,p]=g(!1),s=()=>t.word!==null;Z(()=>{if(t.open){const l=t.word;k(l?.text??""),S(l?.meaning??""),f(l?.pronunciation??""),n(l?.partOfSpeech??""),a(l?.tags?.join(", ")??"")}});async function x(){if(!m().trim()||!C().trim()){y.toast.warning("请填写单词和释义");return}p(!0);const l={text:m().trim(),meaning:C().trim(),pronunciation:o().trim()||void 0,partOfSpeech:c().trim()||void 0,tags:u()?u().split(",").map(d=>d.trim()).filter(Boolean):[]};try{s()&&t.word?(await z.update(t.word.id,l),y.toast.success("单词已更新")):(await z.create(l),y.toast.success("单词已添加")),t.onSaved(),t.onClose()}catch(d){y.toast.error("保存失败",d instanceof Error?d.message:"")}finally{p(!1)}}return e(V,{get open(){return t.open},get onClose(){return t.onClose},get title(){return s()?"编辑单词":"添加单词"},get children(){var l=ge(),d=l.firstChild;return r(l,e(I,{label:"单词",get value(){return m()},onInput:v=>k(v.currentTarget.value),placeholder:"例: abandon"}),d),r(l,e(I,{label:"释义",get value(){return C()},onInput:v=>S(v.currentTarget.value),placeholder:"例: 放弃"}),d),r(l,e(I,{label:"音标",get value(){return o()},onInput:v=>f(v.currentTarget.value),placeholder:"例: /əˈbændən/"}),d),r(l,e(I,{label:"词性",get value(){return c()},onInput:v=>n(v.currentTarget.value),placeholder:"例: v."}),d),r(l,e(I,{label:"标签",get value(){return u()},onInput:v=>a(v.currentTarget.value),placeholder:"逗号分隔，例: CET4, 高频"}),d),r(d,e(M,{variant:"ghost",get onClick(){return t.onClose},children:"取消"}),null),r(d,e(M,{onClick:x,get loading(){return i()},get children(){return s()?"更新":"添加"}}),null),l}})}function me(t){const[m,k]=g("url"),[C,S]=g(""),[o,f]=g(""),[c,n]=g(!1);async function u(){n(!0);try{if(m()==="url"){if(!C().trim()){y.toast.warning("请输入 URL"),n(!1);return}const a=await z.importUrl(C().trim());y.toast.success(`成功导入 ${a.imported} 个单词`)}else{const a=o().trim().split(`
`).filter(Boolean),i=[];for(const s of a){if(s.startsWith("#"))continue;let x;if(s.includes("	"))x=s.split("	");else if(s.includes(" - "))x=s.split(" - ");else continue;x.length>=2&&i.push({text:x[0].trim(),meaning:x[1].trim()})}if(i.length===0){y.toast.warning("未解析到有效数据"),n(!1);return}let p=0;for(let s=0;s<i.length;s+=50){const x=i.slice(s,s+50),l=await z.batchCreate(x);p+=l.count}y.toast.success(`成功导入 ${p} 个单词`)}t.onDone(),t.onClose()}catch(a){y.toast.error("导入失败",a instanceof Error?a.message:"")}finally{n(!1)}}return e(V,{get open(){return t.open},get onClose(){return t.onClose},title:"批量导入",size:"lg",get children(){var a=fe(),i=a.firstChild,p=i.nextSibling;return r(i,e(M,{get variant(){return m()==="url"?"primary":"ghost"},size:"sm",onClick:()=>k("url"),children:"URL 导入"}),null),r(i,e(M,{get variant(){return m()==="text"?"primary":"ghost"},size:"sm",onClick:()=>k("text"),children:"文本粘贴"}),null),r(a,e(E,{get when(){return m()==="url"},get children(){return e(I,{label:"词库文件 URL",get value(){return C()},onInput:s=>S(s.currentTarget.value),placeholder:"https://raw.githubusercontent.com/...",hint:"支持 Tab 分隔或 ' - ' 分隔格式"})}}),p),r(a,e(E,{get when(){return m()==="text"},get children(){var s=he(),x=s.firstChild,l=x.nextSibling;return l.$$input=d=>f(d.currentTarget.value),F(()=>l.value=o()),s}}),p),r(p,e(M,{variant:"ghost",get onClick(){return t.onClose},children:"取消"}),null),r(p,e(M,{onClick:u,get loading(){return c()},children:"开始导入"}),null),a}})}N(["click","input"]);export{we as default};
