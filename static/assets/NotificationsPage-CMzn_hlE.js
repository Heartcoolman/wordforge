import{q as l,b as y,o as R,i as a,c as t,m as S,S as c,B as A,F as B,C as j,d as E,f as m,t as d}from"./index-6s_4JTtF.js";import{B as P}from"./Badge-k5WGClrt.js";import{E as z}from"./Empty-ceooNyMm.js";import{d as F}from"./formatters-DIeyM1Gq.js";const p={list:r=>l.get("/api/notifications",r),markRead:r=>l.put(`/api/notifications/${r}/read`),markAllRead:()=>l.post("/api/notifications/read-all"),getBadges:()=>l.get("/api/notifications/badges"),getPreferences:()=>l.get("/api/notifications/preferences"),updatePreferences:r=>l.put("/api/notifications/preferences",r)};var q=d("<div class=space-y-2>"),I=d('<div class="max-w-2xl mx-auto space-y-6 animate-fade-in-up"><div class="flex items-center justify-between"><div class="flex items-center gap-2"><h1 class="text-2xl font-bold text-content">通知'),L=d('<div class="flex justify-center py-12">'),M=d('<div class="flex justify-between"><div><p class="font-medium text-content text-sm"></p><p class="text-xs text-content-secondary mt-0.5"></p></div><span class="text-xs text-content-tertiary flex-shrink-0 ml-4">');function H(){const[r,u]=y([]),[$,g]=y(!0);async function _(){g(!0);try{const e=await p.list({limit:50});u(e??[])}catch(e){m.toast.error("加载失败",e instanceof Error?e.message:"")}finally{g(!1)}}R(_);async function b(){try{await p.markAllRead(),u(e=>e.map(n=>({...n,read:!0}))),m.toast.success("已全部标记已读")}catch{m.toast.error("操作失败")}}async function k(e){try{await p.markRead(e),u(n=>n.map(s=>s.id===e?{...s,read:!0}:s))}catch{}}const f=()=>r().filter(e=>!e.read).length;return(()=>{var e=I(),n=e.firstChild,s=n.firstChild;return s.firstChild,a(s,t(c,{get when(){return f()>0},get children(){return t(P,{variant:"error",get children(){return[S(()=>f())," 未读"]}})}}),null),a(n,t(c,{get when(){return f()>0},get children(){return t(A,{variant:"ghost",size:"sm",onClick:b,children:"全部已读"})}}),null),a(e,t(c,{get when(){return!$()},get fallback(){return(()=>{var o=L();return a(o,t(E,{size:"lg"})),o})()},get children(){return t(c,{get when(){return r().length>0},get fallback(){return t(z,{title:"暂无通知"})},get children(){var o=q();return a(o,t(B,{get each(){return r()},children:i=>t(j,{get variant(){return i.read?"outlined":"filled"},padding:"sm",hover:!0,onClick:()=>!i.read&&k(i.id),get class(){return i.read?"":"border-l-4 border-l-accent"},get children(){var h=M(),x=h.firstChild,v=x.firstChild,w=v.nextSibling,C=x.nextSibling;return a(v,()=>i.title),a(w,()=>i.message),a(C,()=>F(i.createdAt)),h}})})),o}})}}),null),e})()}export{H as default};
